<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/material-search/material-search.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/google-chart-elasticsearch/google-chart.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/elastic-client/elastic-client.html">
<link rel="import" href="../bower_components/dashboard-youtube/dashboard-youtube.html">
<link rel="import" href="../bower_components/youtube-displayer/youtube-displayer.html">
<link rel="import" href="../bower_components/comments-displayer/comments-displayer.html">
<link rel="import" href="../bower_components/sentiment-displayer/sentiment-displayer.html">

<style type="text/css">
    youtube-displayer .container{
      width: 100% !important;
    }
    html5-video-player{
      border-radius: 20px;
    }
    iframe{ 
      border-radius: 20px;
      margin: 0 auto !important;
      height: 40vh;
      width: 60vw;
      max-width: 626px !important;
      max-height: 396px !important;
    }
    #time1{
    border-radius: 20px;
    margin-top: 20px;
    }
    button{
    border-radius: 20px;
    }
    #time2{
    border-radius: 20px;
    }
    #sentiment-displayer1 #content {
    margin: 0 auto !important;
    }
    table tbody{
      border: none;
    }
    table tbody tr{
      border: none;
    }
    table tbody tr td{
      border:none;
      border-bottom: 1px solid black !important;
    }
    table tbody tr th{
      border: none;
      font-size: 1.3em;
      border-bottom: 2px solid black !important;
    }
    table{
      border-radius: 20px 20px 0px 0px;
    }

    #negativeTable{
      background-color: #de826b !important;
    }
    #positiveTable{
      background-color: #68b5d1;
    }
</style>
<dom-module id="dashboard-youtube">

  <link rel="import" type="css" href="dashboard-youtube.css">

  <template>
      <youtube-displayer
      videoid='{{videoid}}'
      finaltime='{}'
      id="youtube-displayer1"
      ></youtube-displayer>
      <sentiment-displayer
    data='{{data}}'
    initialtime=''
    finaltime=''
    id="sentiment-displayer1"
      ></sentiment-displayer>
      <comments-displayer
    comments="{{comments}}"
    id="comments-displayer1"
      ></comments-displayer>
    </template>




  </template>

  <script>
  var ready = false;
    Polymer({
      is: 'dashboard-youtube',
      properties: {
              comments: {
                type: Object,
                value: ''
              },  
              finaltime: {
                type: String,
                value: ''
              },
              initialtime: {
                type: String,
                value: ''                  
              },
              client: {
                type: Object,
                notify: true,
                observer: '_clientChanged'              
              },              
              data: {
                type: Object,
                value: ''              
              },
              videoid: {
                type: String,
                value: ''
              },
                      fields: {
          type: Array,
          value: function() { return []; }
        },
              filters: {
          type: Array,
          notify: true,
          value: function() { return []; }
        }          
      },

      _clientChanged: function() {
        console.log("ClientChanged");
        ready = true;
        this._query();
      },
      _filtersChange: function() {
        this._query();
       },
       getComments: function() {
              return this.comments;
            },
       _query: function() {
        console.log("_filtersChangedash")
        var that = this;
        console.log("Ready?: ", ready);
        if(ready){
          this.client.search({
          // undocumented params are appended to the query string
          index: "finalindex",
          type: "hate",
          body: {
            size: 100,
            aggs: {
              comments: {
                terms: {
                  field: "comment.keyword",
                  order: {
                    _count: "desc"
                  }
                }
              },
              videoid: {
                terms: {
                  field: "videoid.keyword",
                  order: {
                    _count: "desc"
                  }
                }
              },
              data: {
                terms: {
                  field: "data.keyword",
                  order: {
                    _count: "desc"
                  }
                }
              }                            
            }      
          }
          }).then(function (resp) {
            var myids = []
            resp.hits.hits.forEach(function(entry){myids.push(entry._id)})
            that.ids = myids;
            
            that.comments = resp.hits.hits[0]._source.comments;
            that.data = resp.hits.hits[0]._source.subtitles;
            console.log(resp);
            that.videoid = resp.hits.hits[0]._source.videoId;
           // console.log(that.videoid);
            
            });
        }
      }
    });
  </script>

</dom-module>
