<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../material-search/material-search.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../google-chart-elasticsearch/google-chart.html">
<link rel="import" href="../paper-tabs/paper-tabs.html">
<link rel="import" href="../elastic-client/elastic-client.html">
<link rel="import" href="../dashboard-youtube/dashboard-youtube.html">
<link rel="import" href="../youtube-displayer/youtube-displayer.html">
<link rel="import" href="../comments-displayer/comments-displayer.html">
<link rel="import" href="../sentiment-displayer/sentiment-displayer.html">


<dom-module id="dashboard-youtube">

  <link rel="import" type="css" href="dashboard-youtube.css">

  <template>
      <youtube-displayer
      videoid='{}'
      finaltime='{}'
      id="youtube-displayer1"
      ></youtube-displayer>
      <sentiment-displayer
    data='{}'
    initialtime=''
    finaltime=''
    id="sentiment-displayer1"
      ></sentiment-displayer>
      <comments-displayer
    comments='{}'
    id="comments-displayer1"
      ></comments-displayer>
    </template>




  </template>

  <script>
  var ready = false;
    Polymer({
      is: 'dashboard-youtube',
      properties: {
              comments: {
                type: String,
                value: ''
              },  
              finaltime: {
                type: String,
                value: ''
              },
              initialtime: {
                type: String,
                value: ''                  
              },
              client: {
                type: Object,
                notify: true,
                observer: '_clientChanged'              
              },              
              data: {
                type: Object,
                value: ''              
              },
              videoid: {
                type: String,
                value: ''
              }              
      },

      _clientChanged: function() {
        console.log("ClientChanged");
        ready = true;
        this._query();
      },
      _filtersChange: function() {
        this._query();
       },
       _query: function() {
        console.log("_filtersChangedash")
        var that = this;
        console.log("Ready?: ", ready);
        if(ready){
          this.client.search({
          // undocumented params are appended to the query string
          index: "youtube",
          type: "comment",
          body: {
            size: 10,
            aggs: {
              comments: {
                terms: {
                  field: "comment.keyword",
                  order: {
                    _count: "desc"
                  }
                }
              }
            }      
          }
          }).then(function (resp) {
            var myids = []
            resp.hits.hits.forEach(function(entry){myids.push(entry._id)})
            that.ids = myids;
            //console.log(that.ids)
            that.data = resp;
            //console.log(that.data)
            
            });
        }
      }
    });
  </script>

</dom-module>
